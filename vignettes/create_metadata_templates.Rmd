---
title: "Create metadata templates"
output: html_document
---

```{r setup, include=FALSE}

# Parameterize

dir_path <- '/Users/Colin/Desktop/data_packages'
data_path <- '/Users/Colin/Desktop/data_packages/edi_301/data_objects'

# Initialize .Rmd

knitr::opts_chunk$set(echo = TRUE)
library(kableExtra)
library(EMLassemblyline)

# Clear contents of data package directory

unlink(
  x = '/Users/Colin/Desktop/data_packages/edi_301',
  recursive = TRUE
)

# Create directory structure

template_directories(
  path = dir_path,
  dir.name = 'edi_301'
)

# Copy package objects to data

file.copy(
      from = system.file(
        '/examples/data/decomp.csv',
        package = 'EMLassemblyline'
      ),
      to = paste0(
        data_path,
        "/decomp.csv"
      )
    )

file.copy(
      from = system.file(
        '/examples/data/nitrogen.csv',
        package = 'EMLassemblyline'
      ),
      to = paste0(
        data_path,
        "/nitrogen.csv"
      )
    )

file.copy(
      from = system.file(
        '/examples/data/ancillary_data.zip',
        package = 'EMLassemblyline'
      ),
      to = paste0(
        data_path,
        "/ancillary_data.zip"
      )
    )

file.copy(
      from = system.file(
        '/examples/data/processing_and_analysis.R',
        package = 'EMLassemblyline'
      ),
      to = paste0(
        data_path,
        "/processing_and_analysis.R"
      )
    )

# Set working directory

knitr::opts_knit$set(root.dir = 'C:\\Users\\Colin\\Desktop\\data_packages\\edi_301')

```

## Templating functions

Metadata templates store content that is converted into EML. Each template is created by a function that reads a data entity or object, extracts as much information as possible from data entity or object, then writes this information to file for the user to add information to if necessary. Each templating function focuses on a specific metadata feature thereby allowing the user to highlight the unique features of their data in a modular fashion. Currently available templating functions include:

*  __`template_core_metadata()`__ Create core metadata templates required by all data packages (abstract, methods, keywords, personnel, license). The _additional information_ template (optional) is included.
*  __`template_table_attributes()`__ Create attribute metadata for data tables, including column definitions, classes, and missing value codes. The _custom units_ template is created incase non-standard units need definition.
*  __`template_categorical_variables()`__ Create categorical variable metadata for data tables containing this data class.
*  __`template_geographic_coverage()`__ Create geographic coverage describing sampling points and areas.
*  __`template_taxonomic_coverage()`__ Create taxonomic coverage metadata including resolution to authority systems and hierarchical rank names.

Below is a demonstration of each function and a look at outputs.

## template_core_metadata()

```{r call template_core_metadata, message = FALSE}

# Set working directory

setwd('/Users/Colin/Desktop/data_packages/edi_301')

# Create core templates

template_core_metadata(
  path = './metadata_templates',
  license = 'CC0'
)

# View directory

dir('./metadata_templates')

```

## template_table_attributes()

```{r call template_table_attributes, message = FALSE}

# Create templates for table attributes

template_table_attributes(
  path = './metadata_templates',
  data.path = './data_objects',
  data.table = c('decomp.csv', 'nitrogen.csv')
)

# View directory

dir('./metadata_templates')

# View templates
# NOTE: attributeName and class are autogenerated, and unit and dateTimeFormatString note where specific content is needed.

```

```{r view attributes, echo=FALSE}

# Change taxa class from categorical to character

attributes_decomp <- read.table(
  file = './metadata_templates/attributes_decomp.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 7)
)

attributes_decomp$class[attributes_decomp$attributeName == 'taxa'] <- 'character'

write.table(
  x = attributes_decomp,
  file = './metadata_templates/attributes_decomp.txt', 
  sep = '\t',
  row.names = FALSE,
  quote = FALSE
)

# Read attribute templates

attributes_decomp <- read.table(
  file = './metadata_templates/attributes_decomp.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 7)
)

attributes_nitrogen <- read.table(
  file = './metadata_templates/attributes_nitrogen.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 7)
)

# Display attribute templates

knitr::kable(
  attributes_decomp, caption = 'attributes_decomp.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '100%', height = '300px')


knitr::kable(
  attributes_nitrogen, caption = 'attributes_nitrogen.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '100%', height = '300px')

```

## template_categorical variables()

```{r call template_categorical_variables, message = FALSE}

# Create templates for categorical variables

template_categorical_variables(
  path = './metadata_templates',
  data.path = './data_objects'
)

# View directory

dir('./metadata_templates')

# View templates
# NOTE: attributeName and code is autogenerated.

```

```{r view catvars, echo=FALSE}

# Read catvar templates

catvars_decomp <- read.table(
  file = './metadata_templates/catvars_decomp.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 3)
)

catvars_nitrogen <- read.table(
  file = './metadata_templates/catvars_nitrogen.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 3)
)

# Display catvar templates

knitr::kable(
  catvars_decomp, caption = 'catvars_decomp.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '35%', height = '300px')


knitr::kable(
  catvars_nitrogen, caption = 'catvars_nitrogen.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '35%', height = '300px')

```

## template_geographic_coverage()

```{r call template_geographic_coverage, message = FALSE}

# Create geographic coverage template

template_geographic_coverage(
  path = './metadata_templates',
  data.path = './data_objects',
  data.table = 'nitrogen.csv',
  site.col = 'site_name',
  lat.col = 'site_lat',
  lon.col = 'site_lon'
)

# View directory

dir('./metadata_templates')

# View template

```

```{r view geographic_coverage.txt, echo=FALSE}

# Read geocoverage template

geocoverage <- read.table(
  file = './metadata_templates/geographic_coverage.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 5)
)

# Display geocoverage template

knitr::kable(
  geocoverage, caption = 'geographic_coverage.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '100%', height = '400px')

```

## template_taxonomic_coverage()

```{r call template_taxonomic_coverage, message = FALSE}

# Create taxonomic coverage template

template_taxonomic_coverage(
  path = './metadata_templates',
  data.path = './data_objects',
  taxa.table = 'decomp.csv',
  taxa.col = 'taxa',
  taxa.authority = c(3,11),
  taxa.name.type = 'both'
)

# View directory

dir('./metadata_templates')

# View template
# NOTE: Unresolved taxa lack authority information

```

```{r view taxonomic_coverage.txt, echo=FALSE}

# Read taxonomic coverage template

taxacoverage <- read.table(
  file = './metadata_templates/taxonomic_coverage.txt',
  header = TRUE,
  sep = '\t',
  quote = "\"",
  as.is = TRUE,
  comment.char = "",
  fill = T,
  colClasses = rep("character", 5)
)

# Display taxonomic coverage template

knitr::kable(
  taxacoverage, caption = 'taxonomic_coverage.txt') %>%
  kableExtra::kable_styling('bordered', font_size = 12) %>%
  kableExtra::scroll_box(width = '70%', height = '400px')

```
